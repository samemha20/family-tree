<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>رسائل الدعم</title>

  <script src="/theme.js"></script>
  <link rel="stylesheet" href="/styles.css"/>
</head>
<body>

<header class="topbar">
  <div class="brand">
    <img class="brandLogo" src="/assets/logo.png" alt="شعار العائلة" />
    <div class="brandText">
      <div class="title">رسائل الدعم والشكاوى</div>
      <div class="subtitle">عرض الرسائل المرسلة من صفحة الدعم</div>
    </div>
  </div>

  <nav class="topnav" aria-label="التنقل الرئيسي">
    <a class="navLink" href="/">الشجرة</a>
    <a class="navLink" href="/about">نبذة</a>
    <a class="navLink" href="/honor">قائمة الشرف</a>
    <a class="navLink" href="/tree-pdf">شجرة PDF</a>
    <a class="navLink" href="/support">الدعم</a>
  </nav>

  <div class="actions">
    <button id="themeToggle" class="adminBtn" type="button">الوضع: داكن</button>
    <a class="adminBtn" href="/admin">الأشخاص</a>
    <a class="adminBtn" href="/admin/pages">إدارة الصفحات</a>
    <a class="adminBtn" href="/admin/honor">إدارة الشرف</a>
    <a class="adminBtn" href="/admin/support-messages/export.csv">تصدير CSV</a>
    <form method="post" action="/admin/logout" style="margin:0">
      <button class="adminBtn" type="submit">تسجيل خروج</button>
    </form>
  </div>
</header>

<div class="page">

  <% if (deleted) { %>
    <div class="card" style="margin-bottom:12px">
      <div class="cardBody" style="font-weight:900; color:#22c55e">✅ تم حذف الرسالة</div>
    </div>
  <% } %>

  <div class="card">
    <div class="cardHeader">
      <div>
        <div style="font-weight:950">الرسائل</div>
        <div class="small">الترتيب: الأحدث أولًا</div>
      </div>
      <div class="small"><b><%= msgs.length %></b> رسالة</div>
    </div>

    <div class="cardBody" style="overflow:auto">
      <% if (!msgs || msgs.length === 0) { %>
        <div class="muted">لا توجد رسائل حتى الآن.</div>
      <% } else { %>

        <table class="table">
          <thead>
            <tr>
              <th>ID</th>
              <th>الاسم</th>
              <th>الهاتف</th>
              <th>الرسالة</th>
              <th>التاريخ</th>
              <th>إجراءات</th>
            </tr>
          </thead>
          <tbody>
            <% for (let i=0; i<msgs.length; i++){ const m = msgs[i]; %>
              <tr>
                <td><%= m.id %></td>
                <td><%= m.sender_name || "-" %></td>
                <td class="small"><%= m.phone || "-" %></td>
                <td style="max-width:520px">
                  <div class="small" style="line-height:1.8; white-space:pre-wrap"><%= m.message || "" %></div>
                </td>
                <td class="small"><%= m.created_at || "-" %></td>
                <td>
                  <div class="rowActions">
                    <form method="post"
                          action="/admin/support-messages/<%= m.id %>/delete"
                          style="margin:0"
                          onsubmit="return confirm('متأكد من حذف هذه الرسالة؟');">
                      <button class="ghostBtn" type="submit">حذف</button>
                    </form>
                  </div>
                </td>
              </tr>
            <% } %>
          </tbody>
        </table>

      <% } %>
    </div>
  </div>

</div>

</body>
</html>
